<controls:MetroWindow
    x:Class="SpellEditor.OpenAIWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
    Title="Spell Editor AI Assistant"
    WindowStartupLocation="CenterScreen"
    Icon="icon.ico"
    Width="1150"
    Height="850"
    BorderThickness="2"
    BorderBrush="#1585B5"
    Loaded="_Loaded">

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Mode selection -->
            <RowDefinition Height="Auto"/>
            <!-- Similar spells config -->
            <RowDefinition Height="Auto"/>
            <!-- Prompt label -->
            <RowDefinition Height="3*"/>
            <!-- Prompt area -->
            <RowDefinition Height="Auto"/>
            <!-- Similar spells output -->
            <RowDefinition Height="Auto"/>
            <!-- Buttons -->
            <RowDefinition Height="6*"/>
            <!-- Output area -->
            <RowDefinition Height="Auto"/>
            <!-- Status bar -->
        </Grid.RowDefinitions>

        <!-- Row 0: Mode Selection -->
        <StackPanel Grid.Row="0"
                    Orientation="Horizontal"
                    Margin="0,0,0,10">
            <RadioButton x:Name="RadioModifyExisting"
                 Content="Modify Selected Spell"
                 IsChecked="True"
                 Margin="0,0,10,4"/>

            <RadioButton x:Name="RadioCreateNew"
                 Content="Create New Spell"
                 Margin="0,0,10,4"/>

            <RadioButton x:Name="RadioAskQuestion"
                 Content="Ask a Question"
                 Margin="0,0,10,4"/>

            <RadioButton x:Name="RadioBalanceSpell"
                 Content="Balance This Spell"
                 Margin="0,0,10,4"/>
        </StackPanel>

        <!-- Row 1: Similar spells options -->
        <StackPanel Grid.Row="1" Margin="0,10,0,10">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <CheckBox x:Name="UseSimilarSpellsCheckBox"
                  Content="Use Similar Spells"
                  IsChecked="True"
                  Margin="0,0,15,0"/>

                <TextBlock Text="Max Examples:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                <ComboBox x:Name="SimilarSpellCountCombo"
                  Width="50"
                  SelectedIndex="2">
                    <ComboBoxItem>1</ComboBoxItem>
                    <ComboBoxItem>2</ComboBoxItem>
                    <ComboBoxItem>3</ComboBoxItem>
                    <ComboBoxItem>4</ComboBoxItem>
                    <ComboBoxItem>5</ComboBoxItem>
                </ComboBox>
            </StackPanel>
        </StackPanel>

        <!-- Row 2: Prompt Label -->
        <TextBlock Grid.Row="2"
                   FontSize="16"
                   Text="Describe the spell you want to create or modify:"
                   FontWeight="Bold"
                   Margin="0,0,0,5"/>

        <!-- Row 3: Prompt Box -->
        <Border Grid.Row="3"
                BorderBrush="#555"
                BorderThickness="1"
                CornerRadius="4"
                Padding="4"
                Margin="0,5,0,10">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <TextBox x:Name="PromptTextBox"
                         AcceptsReturn="True"
                         VerticalScrollBarVisibility="Auto"
                         TextWrapping="Wrap"
                         FontSize="14"
                         BorderThickness="0"
                         Background="Transparent"/>
            </ScrollViewer>
        </Border>

        <!-- Row 4: Collapsible panel for showing similar spells used -->
        <Expander x:Name="SimilarSpellsExpander"
          Header="Similar Spells Used"
          Grid.Row="4"
          Margin="0,0,0,10"
          IsExpanded="False">
            <ScrollViewer VerticalScrollBarVisibility="Auto" Height="180">
                <TextBox x:Name="SimilarSpellsTextBox"
                 FontFamily="Consolas"
                 FontSize="12"
                 IsReadOnly="True"
                 TextWrapping="Wrap"
                 Padding="5"
                 BorderThickness="0"/>
            </ScrollViewer>
        </Expander>

        <!-- Row 5: Buttons -->
        <StackPanel Grid.Row="5"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,10,0,10">

            <Button x:Name="GenerateButton"
                    Width="160"
                    Height="36"
                    Margin="0,0,15,0"
                    FontSize="14"
                    Content="Generate"
                    Click="GenerateButton_Click"/>

            <Button x:Name="ApplyButton"
                    Width="180"
                    Height="36"
                    Margin="0,0,15,0"
                    FontSize="14"
                    Content="Apply Changes"
                    IsEnabled="False"
                    Click="ApplyButton_Click"/>

            <Button Width="120"
                    Height="36"
                    FontSize="14"
                    Content="Close"
                    Click="CloseButton_Click"/>
        </StackPanel>

        <!-- Row 6: Output Area with Splitter -->
        <Grid Grid.Row="6">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" MinWidth="300"/>
                <ColumnDefinition Width="6"/>
                <!-- splitter -->
                <ColumnDefinition Width="*" MinWidth="300"/>
            </Grid.ColumnDefinitions>

            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <Grid x:Name="LoadingSpinner" Visibility="Collapsed">
                    <ProgressBar 
                        IsIndeterminate="True"
                        Width="200"
                        Height="20"
                        Margin="10"/>
                                <TextBlock 
                        Text="Generating spell..."
                        HorizontalAlignment="Center"
                        Margin="0,35,0,0"/>
                </Grid>
            </StackPanel>

            <!-- LEFT: Raw JSON -->
            <Border Grid.Column="0"
                    BorderBrush="#444"
                    BorderThickness="1"
                    CornerRadius="4"
                    Margin="0,0,10,0">
                <RichTextBox x:Name="JsonOutputBox"
                     FontFamily="Consolas"
                     FontSize="13"
                     BorderThickness="0"
                     Background="Transparent"
                     VerticalScrollBarVisibility="Auto"
                     HorizontalScrollBarVisibility="Auto"
                     IsDocumentEnabled="True"
                     IsReadOnly="True"/>
            </Border>

            <GridSplitter Grid.Column="1"
                          Width="6"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch"
                          Background="#666"/>

            <!-- RIGHT: Parsed Summary -->
            <Border Grid.Column="2"
                    BorderBrush="#444"
                    BorderThickness="1"
                    CornerRadius="4"
                    Margin="10,0,0,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">

                        <TextBlock Text="Icon Preview:"
                            FontWeight="Bold"/>

                        <Image x:Name="SummaryIconImage"
                           Width="48"
                           Height="48"
                           Margin="1"
                           Stretch="Uniform"
                           HorizontalAlignment="Left"/>

                        <TextBlock Text="Name:" FontWeight="Bold" FontSize="14"/>
                        <TextBlock x:Name="SummaryNameTextBlock"
                                   FontSize="14"
                                   Margin="0,0,0,10"
                                   TextWrapping="Wrap"/>

                        <TextBlock Text="Description:" FontWeight="Bold" FontSize="14"/>
                        <TextBlock x:Name="SummaryDescriptionTextBlock"
                                   FontSize="14"
                                   Margin="0,0,0,10"
                                   TextWrapping="Wrap"/>

                        <TextBlock Text="Range (yards):" FontWeight="Bold" FontSize="14"/>
                        <TextBlock x:Name="SummaryRangeTextBlock"
                                   FontSize="14"
                                   Margin="0,0,0,10"/>

                        <TextBlock Text="Direct Damage:" FontWeight="Bold" FontSize="14"/>
                        <TextBlock x:Name="SummaryDamageTextBlock"
                                   FontSize="14"
                                   Margin="0,0,0,10"/>

                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- Row 7: Status Bar -->
        <StatusBar Grid.Row="7" Margin="0,10,0,0">
            <StatusBarItem>
                <TextBlock x:Name="StatusTextBlock"
                           FontSize="14"
                           Text="Ready."/>
            </StatusBarItem>
        </StatusBar>

    </Grid>
</controls:MetroWindow>